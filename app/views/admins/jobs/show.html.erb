<section class="section">
  <div class="container radius-8">
    <div class="columns">
      <div class="column">    
        <p> <%= t('jobs.reference') %>: #<%= @job.reference %> </p>
        <strong class="f3"> 
          <%= job_price_label(@job.job_price&.internal_name) %> 
          <%= icon('far', 'calendar-alt') %> <%= job_expired(@job) %> 
        </strong> 
        <%= t('remaining_days') %>
      </div>
      <div class="column has-text-right">
        <%= link_to edit_admins_job_path(@job), class: 'button is-link' do %>
          <%= icon('fas', 'edit mr1') %> <%= t('jobs.edit') %>
        <% end %>
        <%= link_to job_path(@job), class: 'button', target: '_blank' do %>
          <%= icon('fas', 'eye mr1') %> <%= t('show_job_post') %>
        <% end if @job.open %>
      </div>
    </div>
  </div>
</section>

<section class="section">
  <div class="container">
    <article class="message is-warning">
      <div class="message-header">
        <h1> Estás como ADMIN </h1>
      </div>
      <div class="message-body">
      Esto es exactamente lo que <strong> ve la empresa </strong>. Puedes editarlo sin problemas, pero con responsabilidad 👀.
      </div>
    </article>
  </div>
</section>

<hr>

<section class="section">
  <div class="container">
    <div class="info-tiles">
      <div class="tile has-text-centered mb4">
        <div class="tile is-parent">
          <article class="tile is-child box">
            <p class="title"> <%= @job.inscriptions.count %> </p>
            <p class="subtitle"><%= icon('fas', 'check-circle has-text-success') %> <%= t("inscriptions.inscribeds") %> </p>
          </article>
        </div>
        <div class="tile is-parent">
          <article class="tile is-child box">
            <p class="title"> <%= @finalists_count %> </p>
            <p class="subtitle"><%= icon('fas', 'trophy has-text-warning') %> <%= t("inscriptions.finalists") %> </p>
          </article>
        </div>
        <div class="tile is-parent">
          <article class="tile is-child box">
            <p class="title"> <%= @in_process_count %> </p>
            <p class="subtitle"> <%= icon('fas', 'user-clock has-text-info') %> <%= t("inscriptions.in_process") %> </p>
          </article>
        </div>
        <div class="tile is-parent">
          <article class="tile is-child box">
            <p class="title"><%= @discardeds_count %></p>
            <p class="subtitle"> <%= icon('fas', 'heart-broken has-text-danger') %> <%= t("inscriptions.discardeds") %> </p>
          </article>
        </div>
      </div>
    </div>
  </div>
  <div class="container pt4">
    <%= render partial: "/jobs/shared/job_info", locals: { job: @job } %>
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="columns">
      <div class="column">
        <h3 class="title"> <%= t('inscribed_candidates') %>: <%= @inscriptions_count %> </h3>
      </div>
      <div class="column mb4 has-text-right">
        <% if @inscriptions.any? %>
          <%= link_to admins_job_inscriptions_path(job_id: @job.id, format: "xlsx"), class: 'button' do %>
            <%= icon('fas', 'file-download pr2', class: 'has-excel-color') %> <%= t('download_candidates_excel') %>
          <% end %>
        <% end %>
      </div>
    </div>
    <div class="columns">
      <div class="column">
        <span class="tag"> <%= icon('fas', 'check-circle mr1', class: 'has-text-success') %> <%= @inscriptions_count %> </span>
        <span class="tag"> <%= icon('fas', 'heart-broken mr1', class: 'has-text-danger') %> <%= @discardeds_count %> </span>
        <span class="tag"> <%= icon('fas', 'user-clock mr1', class: 'has-text-info') %> <%= @in_process_count %> </span>
        <span class="tag"> <%= icon('fas', 'trophy mr1', class: 'has-text-warning') %> <%= @finalists_count %> </span>
      </div>
    </div>
    <%= form_tag(admins_job_path(@job.id), method: :get, class: "mb3") do %>
      <div class="is-flex is-justify-content-flex-end job-filters">
        <div>
          <div class="control has-icons-left">
            <div class="select">
              <%= select_tag :by_country_code, 
                options_for_select(@inscriptions_country_codes, params[:by_country_code]), 
                :include_blank => t('select.resident_country_code') %>
            </div>
            <span class="icon is-left">
              <%= icon('fas', 'flag') %>
            </span>
          </div>
        </div>
        <div class="ml3">
          <div class="control has-icons-left">
            <div class="select">
              <%= select_tag :by_experience, 
                options_for_select([ "0-2 años", "2-6 años", "6-10 años", "+10 años" ], params[:by_experience]), 
                :include_blank => "Años de experiencia" %>
            </div>
            <span class="icon is-left">
              <%= icon('fas', 'graduation-cap') %>
            </span>
          </div>
        </div>
        <div class="ml3">
          <div class="control has-icons-left">
            <div class="select">
              <%= select_tag :by_status, 
                options_for_select(Inscription.statuses.keys.map {|status, id| [t("inscriptions.#{status}"), status]}, params[:by_status]), 
                :include_blank => t('inscriptions.process_status') %>
            </div>
            <span class="icon is-left">
              <%= icon('fas', 'clock') %>
            </span>
          </div>
        </div>
        <div>
          <%= button_tag(t('apply_filters'), type: 'submit', class: "button is-text is-fullwidth", data: { disable_with: "<i class='fas fa-spinner fa-spin'></i>".html_safe }) %>
        </div>
      </div>
    <% end %>
    <% if @inscriptions.any? %>
      <% @inscriptions.each do |inscription| %>
        <%= render partial: 'admins/jobs/inscriptions/inscription', locals: { inscription: inscription } %>
      <% end %>
    <% else %>
      <div class="columns mt5">
        <div class="column has-text-centered">
          <%= image_tag(asset_path('no_data_undraw.svg'), class: 'has-opacity-5', height: 200, width: 200) %>
        </div>
      </div>
    <% end %>
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="columns">
      <div class="column">
        <article class="message is-info">
          <div class="message-header">
            <p>Info Admin</p>
          </div>
          <div class="message-body">
            Solo las empresas que han publicado con precio PRO ven esta sección
          </div>
        </article>
      </div>
    </div>
    <div class="columns">
      <div class="column">
        <h3 class="title"> <%= t('added_we_match_candidates') %>: <%= @we_match_inscriptions_count %> </h3>
      </div>
      <div class="column mb4 has-text-right">
        <% if @job.open? %>
          <%= button_tag(type: 'button',
            class: "button is-warning we-match-button has-text-weight-bold #{ 'is-static' if @matching_candidates.empty?}",
            'data-target': 'we-match-modal',
            'aria-haspopup': 'true',
            disabled: @matching_candidates.empty?) do %>
              <%= icon('fas', 'gem', class: 'has-text-info mr1') %> We Match: <%= @matching_candidates.empty? ? '0' : @matching_candidates.count %> encontrados
          <% end %>
        <% else %>
          <%= button_tag('Job Finalizado. No es posible añadir más candidatos', type: 'button', class: 'button is-static') %>
        <% end %>
      </div>
    </div>
    <% if @we_match_inscriptions.any? %>
        <% @we_match_inscriptions.each do |inscription| %>
          <%= render partial: 'admins/jobs/inscriptions/inscription', locals: { inscription: inscription } %>
        <% end %>
    <% else %>
      <div class="columns mt5">
        <div class="column has-text-centered">
          <%= image_tag(asset_path('no_data_undraw.svg'), class: 'has-opacity-5', height: 200, width: 200) %>
        </div>
      </div>
    <% end %>
  </div>
</section>

<hr>

<section class="section">
  <div class="container has-text-centered">
    <h3 class="title"> <%= t('finalized_job_question') %> </h3>
    <%= button_tag(type: 'button',
      class: 'button is-danger is-outlined deactivate-job-button',
      'data-target': 'deactivate-job-modal',
      'aria-haspopup': 'true',
      disabled: !@job.open?) do %>
        <%= icon('fas', 'calendar-times mr2') %> <%= t('jobs.close') %> 
    <% end %>
  </div>
</section>

<%= render partial: '/jobs/partials/deactivate_job_modal', locals: { job: @job, model: :admins } %>
<%= render partial: '/jobs/shared/we_match_modal', locals: { job: @job, matching_candidates: @matching_candidates, model: 'admins' } if @job.open? && @matching_candidates.present? %>

<%= content_for :footer do %>
  <script>

    $(document).ready(function() {     
      $(document).on("click", ".modal-close, .modal-close-footer", function() {
        $('.modal').removeClass('is-active');
        location.reload();
      });

      $(document).on("click", ".deactivate-job-button", function() {
        $('.deactivate-job-modal').addClass('is-active');
      });

      $(document).on("click", ".we-match-button", function() {
        $('.we-match-modal').addClass('is-active');
      });

      $(".best_in_place").best_in_place();
    });

  </script>
<% end %>
